{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport PromptDialog from '@/components/PromptDialog.vue';\nexport default {\n  name: \"VeiculoList\",\n  components: {\n    PromptDialog\n  },\n  props: {\n    permissao: Object,\n    disabledButtons: Boolean\n  },\n  data: () => ({\n    headers: [{\n      text: \"Placa\",\n      value: \"placa\"\n    }, {\n      text: \"Marca/Modelo\",\n      value: \"desc_marca_modelo\"\n    }, {\n      text: \"Ano Fabricação\",\n      value: \"ano_fabricacao\"\n    }, {\n      text: \"Alvará\",\n      value: \"alvara\"\n    }, {\n      text: \"Validade Alvará\",\n      value: \"alvara_validade\"\n    }, {\n      text: \"Pré-cadastro\",\n      value: \"pre_cadastro\"\n    }, {\n      text: \"Ações\",\n      value: \"action\"\n    }],\n    totalItems: 0,\n    items: [],\n    options: {},\n    placa: {},\n    filtro: {\n      placa: null\n    },\n    filtroAnterior: {\n      placa: null\n    }\n  }),\n  watch: {\n    options: {\n      handler() {\n        this.getVeiculos();\n      },\n      deep: true\n    }\n  },\n  methods: {\n    async getVeiculos() {\n      const {\n        sortBy,\n        sortDesc,\n        page,\n        itemsPerPage\n      } = this.options;\n      let resetPage = false;\n      let ordering = sortBy[0];\n      if (sortDesc[0]) {\n        ordering = `-${ordering}`;\n      }\n      if (this.filtro.placa !== this.filtroAnterior.placa) {\n        resetPage = true;\n        this.options.page = 1;\n        this.filtroAnterior = {\n          ...this.filtro\n        };\n      }\n      ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n      const query = {\n        permissao: this.permissao.id,\n        page: resetPage ? 1 : page,\n        page_size: itemsPerPage,\n        ordering: ordering,\n        placa: this.filtro.placa\n      };\n      const response = await this.$api.list({\n        resource: this.$endpoints.VEICULO,\n        query: query\n      });\n      this.items = response.data.results;\n      this.totalItems = response.data.count;\n    },\n    editarVeiculo(item) {\n      if (item.pre_cadastro) {\n        this.$router.push(`/veiculo/precadastro/${item.id}`);\n      } else {\n        this.$router.push(`/veiculo/${item.id}`);\n      }\n    },\n    async deletarVeiculo(veiculoId) {\n      const res = await this.$refs.prompt.open('Requerimento', 'Informe o número do requerimento', 'Número do requerimento');\n      if (res) {\n        const response = this.$api.destroy({\n          resource: this.$endpoints.VEICULO,\n          id: veiculoId,\n          data: {\n            numero_requerimento: res\n          }\n        });\n        response.then(() => this.getVeiculos()).catch(err => {\n          this.$toast.open({\n            message: err,\n            type: \"error\"\n          });\n        });\n      }\n    },\n    async vistoriarVeiculo(veiculoId) {\n      const response = this.$api.create({\n        resource: this.$endpoints.VISTORIA,\n        data: {\n          veiculo: veiculoId,\n          parecer: 'pendente',\n          usuario: this.user.user_id\n        }\n      });\n      response.then(() => {\n        this.$toast.open({\n          message: 'Vistoria solicitada com sucesso',\n          type: \"success\"\n        });\n      }).catch(error => {\n        this.handleError(error);\n      });\n    },\n    limparFiltros() {\n      this.filtro = {\n        placa: null\n      };\n      this.getVeiculos();\n    },\n    transformToUppercase() {\n      this.filtro.placa = this.filtro.placa.toUpperCase();\n    }\n  }\n};","map":{"version":3,"names":["PromptDialog","name","components","props","permissao","Object","disabledButtons","Boolean","data","headers","text","value","totalItems","items","options","placa","filtro","filtroAnterior","watch","handler","getVeiculos","deep","methods","sortBy","sortDesc","page","itemsPerPage","resetPage","ordering","query","id","page_size","response","$api","list","resource","$endpoints","VEICULO","results","count","editarVeiculo","item","pre_cadastro","$router","push","deletarVeiculo","veiculoId","res","$refs","prompt","open","destroy","numero_requerimento","then","catch","err","$toast","message","type","vistoriarVeiculo","create","VISTORIA","veiculo","parecer","usuario","user","user_id","error","handleError","limparFiltros","transformToUppercase","toUpperCase"],"sources":["src/views/veiculo/VeiculoList.vue"],"sourcesContent":["<template>\n  <v-card flat>\n    <v-card-text>\n      <div class=\"d-flex align-center\">\n        <div style=\"max-width: 500px\">\n          <v-text-field\n            v-model=\"filtro.placa\"\n            label=\"Placa\"\n            :items=\"placa\"\n            class=\"mr-3\"\n            @input=\"transformToUppercase\"\n          />\n        </div>\n        <v-btn\n          color=\"blue-grey darken-4 mr-3\"\n          dark\n          @click=\"getVeiculos\"\n        >\n          <v-icon>search</v-icon>\n          Pesquisar\n        </v-btn>\n        <v-btn\n          outlined\n          color=\"blue-grey darken-4\"\n          @click=\"limparFiltros\"\n        >\n          Limpar filtros\n        </v-btn>\n      </div>\n      <v-data-table\n        :headers=\"headers\"\n        :items=\"items\"\n        :options.sync=\"options\"\n        :server-items-length=\"totalItems\"\n        :items-per-page=\"10\"\n        :footer-props=\"{\n          'items-per-page-options': [10, 20, 30]\n        }\"\n      >\n        <template #[`item.pre_cadastro`]=\"{ item }\">\n          <v-chip\n            v-if=\"item.pre_cadastro\"\n            color=\"red darken-2\"\n            dark\n          >\n            Pré-cadastro\n          </v-chip>\n          <v-chip\n            v-else\n            color=\"green darken-2\"\n            dark\n          >\n            Cadastro\n          </v-chip>\n        </template>\n        <template #[`item.action`]=\"{ item }\">\n          <v-toolbar-items>\n            <v-tooltip bottom>\n              <template #activator=\"{ on, attrs }\">\n                <v-btn\n                  v-bind=\"attrs\"\n                  icon\n                  :disabled=\"disabledButtons\"\n                  v-on=\"on\"\n                  @click=\"editarVeiculo(item)\"           \n                >\n                  <v-icon class=\"material-icons-outlined\">\n                    visibility\n                  </v-icon>\n                </v-btn>\n              </template>\n              <span>Editar</span>\n            </v-tooltip>\n            <v-tooltip bottom>\n              <template #activator=\"{ on, attrs }\">\n                <v-btn\n                  v-bind=\"attrs\"\n                  icon\n                  :disabled=\"disabledButtons\"\n                  v-on=\"on\"\n                  @click=\"deletarVeiculo(item.id)\"          \n                >\n                  <v-icon class=\"material-icons-outlined\">\n                    delete\n                  </v-icon>\n                </v-btn>\n              </template>\n              <span>Deletar</span>\n            </v-tooltip>\n            <v-tooltip bottom>\n              <template #activator=\"{ on, attrs }\">\n                <v-btn\n                  v-bind=\"attrs\"\n                  icon\n                  :disabled=\"disabledButtons\"\n                  v-on=\"on\"\n                  @click=\"vistoriarVeiculo(item.id)\"          \n                >\n                  <v-icon class=\"material-icons-outlined\">\n                    checklist\n                  </v-icon>\n                </v-btn>\n              </template>\n              <span>Vistoriar</span>\n            </v-tooltip>\n          </v-toolbar-items>\n        </template>\n      </v-data-table>\n      <PromptDialog ref=\"prompt\" />\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport PromptDialog from '@/components/PromptDialog.vue'\n\nexport default {\n    name: \"VeiculoList\",\n    components: { PromptDialog },\n    props: {\n        permissao: Object,\n        disabledButtons: Boolean\n    },\n    data: () => ({\n        headers: [\n            { text: \"Placa\", value: \"placa\" },\n            { text: \"Marca/Modelo\", value: \"desc_marca_modelo\" },\n            { text: \"Ano Fabricação\", value: \"ano_fabricacao\" },\n            { text: \"Alvará\", value: \"alvara\" },\n            { text: \"Validade Alvará\", value: \"alvara_validade\" },\n            { text: \"Pré-cadastro\", value: \"pre_cadastro\" },\n            { text: \"Ações\", value: \"action\" },\n        ],\n        totalItems: 0,\n        items: [],\n        options: {},\n        placa:{},\n        filtro: {\n          placa: null,\n        },\n        filtroAnterior: {\n          placa: null,\n        },\n    }),\n    watch: {\n        options: {\n            handler() {\n                this.getVeiculos();\n            },\n            deep: true\n        },\n    },\n    methods: {\n      async getVeiculos() { \n        const { sortBy, sortDesc, page, itemsPerPage } = this.options   \n        let resetPage = false;\n        let ordering = sortBy[0];\n        if (sortDesc[0]) {\n          ordering = `-${ordering}`;\n        }\n\n        if (\n          this.filtro.placa !== this.filtroAnterior.placa\n        ) {\n          resetPage = true;\n          this.options.page = 1;\n          this.filtroAnterior = { ...this.filtro };\n        }\n        \n        ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n        \n        const query = {\n          permissao: this.permissao.id,\n          page: resetPage ? 1 : page,\n          page_size: itemsPerPage,\n          ordering: ordering,\n          placa: this.filtro.placa,\n        }\n        const response = await this.$api.list({\n            resource: this.$endpoints.VEICULO,\n            query: query\n        });\n        this.items = response.data.results;\n        this.totalItems = response.data.count;\n      },\n      editarVeiculo(item) {\n        if(item.pre_cadastro) {\n          this.$router.push(`/veiculo/precadastro/${item.id}`)\n        } else {\n          this.$router.push(`/veiculo/${item.id}`)\n        }\n      },\n      async deletarVeiculo(veiculoId) {\n          const res = await this.$refs.prompt.open(\n            'Requerimento',\n            'Informe o número do requerimento',\n            'Número do requerimento'\n          )\n          if (res) {\n              const response = this.$api.destroy({\n                  resource: this.$endpoints.VEICULO,\n                  id: veiculoId,\n                  data: {\n                    numero_requerimento: res\n                  }\n              });\n              response\n                  .then(() => this.getVeiculos())\n                  .catch(err => {\n                  this.$toast.open({\n                      message: err,\n                      type: \"error\",\n                  });\n              });\n          }\n      },\n      async vistoriarVeiculo(veiculoId) {\n        const response = this.$api.create({\n            resource: this.$endpoints.VISTORIA,\n            data: {\n              veiculo: veiculoId,\n              parecer: 'pendente',\n              usuario: this.user.user_id,\n            }\n        });\n        response\n            .then(() => {\n                this.$toast.open({\n                    message: 'Vistoria solicitada com sucesso',\n                    type: \"success\",\n                });\n            })\n            .catch(error => {\n              this.handleError(error)\n            });\n      },\n      limparFiltros() {\n        this.filtro = {\n          placa: null,\n        }\n        this.getVeiculos()\n      },\n      transformToUppercase() {\n        this.filtro.placa = this.filtro.placa.toUpperCase();\n      },\n    }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}