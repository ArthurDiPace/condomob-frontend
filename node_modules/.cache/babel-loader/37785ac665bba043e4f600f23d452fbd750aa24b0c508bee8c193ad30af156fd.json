{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport * as documentoService from '@/services/documento.service';\nexport default {\n  name: 'OficioList',\n  props: {\n    permissao: Object,\n    disabledButtons: Boolean\n  },\n  data: () => ({\n    headers: [{\n      text: 'Número',\n      value: 'numero'\n    }, {\n      text: 'Data de Envio',\n      value: 'data'\n    }, {\n      text: 'Data de Validade',\n      value: 'validade'\n    }, {\n      text: 'Placa',\n      value: 'placa'\n    }, {\n      text: 'Exercício',\n      value: 'exercicio'\n    }, {\n      text: 'Usuário',\n      value: 'usuario'\n    }, {\n      text: 'Situação',\n      value: 'situacao'\n    }, {\n      text: 'Ações',\n      value: 'action'\n    }],\n    placa: {},\n    filtro: {\n      placa: null\n    },\n    items: [],\n    totalItems: 0,\n    options: {},\n    errors: [],\n    filtroAnterior: {\n      placa: null\n    }\n  }),\n  watch: {\n    options: {\n      handler() {\n        this.getOficios();\n      },\n      deep: true\n    }\n  },\n  methods: {\n    async getOficios() {\n      const {\n        sortBy,\n        sortDesc,\n        page,\n        itemsPerPage\n      } = this.options;\n      let resetPage = false;\n      let ordering = sortBy[0];\n      if (sortDesc[0]) {\n        ordering = `-${ordering}`;\n      }\n      if (this.filtro.placa !== this.filtroAnterior.placa) {\n        resetPage = true;\n        this.options.page = 1;\n        this.filtroAnterior = {\n          ...this.filtro\n        };\n      }\n      ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n      const query = {\n        permissao: this.permissao.id,\n        page: resetPage ? 1 : page,\n        page_size: itemsPerPage,\n        ordering: ordering,\n        placa: this.filtro.placa\n      };\n      const response = await this.$api.list({\n        resource: this.$endpoints.OFICIO,\n        query: query\n      });\n      this.items = response.data.results;\n      this.totalItems = response.data.count;\n    },\n    imprimirOficio(oficioId) {\n      let request = documentoService.carregarArquivo({\n        resource: `${this.$endpoints.OFICIO}/segunda_via/`,\n        data: {\n          id_oficio: oficioId\n        }\n      });\n      request.then(response => {\n        const downloadUrl = window.URL.createObjectURL(response.data);\n        window.open(downloadUrl, '__blank');\n      }).catch(error => {\n        this.handleBlobError(error);\n      });\n    },\n    cancelarOficios(oficioId) {\n      const response = this.$api.create({\n        resource: this.$endpoints.CANCELAR_OFICIOS,\n        data: {\n          id_oficio: oficioId\n        }\n      });\n      response.then(() => {\n        this.$toast.open({\n          message: 'Ofícios cancelados com sucesso',\n          type: 'success'\n        });\n      }).catch(error => {\n        this.errors = this.handleError(error);\n      });\n    },\n    limparFiltros() {\n      this.filtro = {\n        placa: null\n      };\n      this.getOficios();\n    },\n    transformToUppercase() {\n      this.filtro.placa = this.filtro.placa.toUpperCase();\n    }\n  }\n};","map":{"version":3,"names":["documentoService","name","props","permissao","Object","disabledButtons","Boolean","data","headers","text","value","placa","filtro","items","totalItems","options","errors","filtroAnterior","watch","handler","getOficios","deep","methods","sortBy","sortDesc","page","itemsPerPage","resetPage","ordering","query","id","page_size","response","$api","list","resource","$endpoints","OFICIO","results","count","imprimirOficio","oficioId","request","carregarArquivo","id_oficio","then","downloadUrl","window","URL","createObjectURL","open","catch","error","handleBlobError","cancelarOficios","create","CANCELAR_OFICIOS","$toast","message","type","handleError","limparFiltros","transformToUppercase","toUpperCase"],"sources":["src/views/oficio/OficioList.vue"],"sourcesContent":["<template>\n  <v-card flat>\n    <v-card-text>\n      <div class=\"d-flex align-center\">\n        <div style=\"max-width: 500px\">\n          <v-text-field\n            v-model=\"filtro.placa\"\n            label=\"Placa\"\n            :items=\"placa\"\n            class=\"mr-3\"\n            @input=\"transformToUppercase\"\n          />\n        </div>\n        <v-btn\n          color=\"blue-grey darken-4 mr-3\"\n          dark\n          @click=\"getOficios\"\n        >\n          <v-icon>search</v-icon>\n          Pesquisar\n        </v-btn>\n        <v-btn\n          outlined\n          color=\"blue-grey darken-4\"\n          @click=\"limparFiltros\"\n        >\n          Limpar filtros\n        </v-btn>\n      </div>\n      <v-data-table\n        :headers=\"headers\"\n        :items=\"items\"\n        :options.sync=\"options\"\n        :server-items-length=\"totalItems\"\n        :items-per-page=\"10\"\n        :footer-props=\"{\n          'items-per-page-options': [10, 20, 30]\n        }\"\n      >\n        <template #[`item.action`]=\"{ item }\">\n          <v-toolbar-items>\n            <v-tooltip bottom>\n              <template #activator=\"{ on, attrs }\">\n                <v-btn\n                  v-bind=\"attrs\"\n                  icon\n                  v-on=\"on\"\n                  :disabled-buttons=\"permissao.bloqueado\"\n                  @click=\"imprimirOficio(item.id)\"\n                >\n                  <v-icon class=\"material-icons-outlined\">\n                    print\n                  </v-icon>\n                </v-btn>\n              </template>\n              <span>Imprimir Oficio</span>\n            </v-tooltip>\n            <v-tooltip bottom>\n              <template #activator=\"{ on, attrs }\">\n                <v-btn\n                  v-bind=\"attrs\"\n                  icon\n                  v-on=\"on\"\n                  :disabled=\"disabledButtons\"\n                  @click=\"cancelarOficios(item.id)\"\n                >\n                  <v-icon class=\"material-icons-outlined\">\n                    cancel_presentation\n                  </v-icon>\n                </v-btn>\n              </template>\n              <span>Cancelar Oficio</span>\n            </v-tooltip>\n          </v-toolbar-items>\n        </template>\n        <template #[`item.situacao`]=\"{ item }\">\n          <v-icon\n            v-if=\"item.situacao\"\n            color=\"green\"\n          >\n            check_circle\n          </v-icon>\n          <v-icon\n            v-else\n            color=\"red\"\n          >\n            cancel\n          </v-icon>\n        </template>\n      </v-data-table>\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport * as documentoService from '@/services/documento.service'\n\nexport default {\n  name: 'OficioList',\n  props: {\n    permissao: Object,\n    disabledButtons: Boolean\n  },\n  data: () => ({\n    headers: [\n      {text: 'Número', value: 'numero'},\n      {text: 'Data de Envio', value: 'data'},\n      {text: 'Data de Validade', value: 'validade'},\n      {text: 'Placa', value: 'placa'},\n      {text: 'Exercício', value: 'exercicio'},\n      {text: 'Usuário', value: 'usuario'},\n      {text: 'Situação', value: 'situacao'},\n      {text: 'Ações', value: 'action'},\n    ],\n    placa:{},\n    filtro: {\n      placa: null,\n    },\n    items: [],\n    totalItems: 0,\n    options: {},\n    errors: [],\n    filtroAnterior: {\n      placa: null,\n    },\n  }),\n  watch: {\n    options: {\n      handler() {\n        this.getOficios()\n      },\n      deep: true\n    },\n  },\n  methods: {\n    async getOficios() {\n      const { sortBy, sortDesc, page, itemsPerPage } = this.options\n      \n      let resetPage = false;\n      let ordering = sortBy[0];\n      if (sortDesc[0]) {\n        ordering = `-${ordering}`;\n      }\n\n      if (\n        this.filtro.placa !== this.filtroAnterior.placa\n      ) {\n        resetPage = true;\n        this.options.page = 1;\n        this.filtroAnterior = { ...this.filtro };\n      }\n      \n      ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n      \n      const query = {\n        permissao: this.permissao.id,\n        page: resetPage ? 1 : page,\n        page_size: itemsPerPage,\n        ordering: ordering,\n        placa: this.filtro.placa,\n      }\n      \n      const response = await this.$api.list({\n          resource: this.$endpoints.OFICIO,\n          query: query\n      })\n      this.items = response.data.results\n      this.totalItems = response.data.count\n    },\n    imprimirOficio(oficioId) {\n      let request = documentoService.carregarArquivo({\n        resource: `${this.$endpoints.OFICIO}/segunda_via/`,\n        data: {\n          id_oficio: oficioId\n        }\n      })\n      request\n        .then(response => {\n          const downloadUrl = window.URL.createObjectURL(response.data)\n          window.open(downloadUrl, '__blank')\n        })\n        .catch((error) => {\n          this.handleBlobError(error)\n        });\n    },\n    cancelarOficios(oficioId) {\n      const response = this.$api.create({\n        resource: this.$endpoints.CANCELAR_OFICIOS,\n        data: {\n          id_oficio: oficioId\n        }\n      })\n      response\n        .then(()=>{\n          this.$toast.open({\n              message: 'Ofícios cancelados com sucesso',\n              type: 'success',\n          })\n        })\n        .catch(error=>{\n          this.errors = this.handleError(error)\n        })\n    },\n    limparFiltros() {\n      this.filtro = {\n        placa: null,\n      }\n      this.getOficios()\n    },\n    transformToUppercase() {\n      this.filtro.placa = this.filtro.placa.toUpperCase();\n    },\n  }\n}\n</script>"],"mappings":";;;AA+FA,YAAAA,gBAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,SAAA,EAAAC,MAAA;IACAC,eAAA,EAAAC;EACA;EACAC,IAAA,EAAAA,CAAA;IACAC,OAAA,GACA;MAAAC,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,GACA;MAAAD,IAAA;MAAAC,KAAA;IAAA,EACA;IACAC,KAAA;IACAC,MAAA;MACAD,KAAA;IACA;IACAE,KAAA;IACAC,UAAA;IACAC,OAAA;IACAC,MAAA;IACAC,cAAA;MACAN,KAAA;IACA;EACA;EACAO,KAAA;IACAH,OAAA;MACAI,QAAA;QACA,KAAAC,UAAA;MACA;MACAC,IAAA;IACA;EACA;EACAC,OAAA;IACA,MAAAF,WAAA;MACA;QAAAG,MAAA;QAAAC,QAAA;QAAAC,IAAA;QAAAC;MAAA,SAAAX,OAAA;MAEA,IAAAY,SAAA;MACA,IAAAC,QAAA,GAAAL,MAAA;MACA,IAAAC,QAAA;QACAI,QAAA,OAAAA,QAAA;MACA;MAEA,IACA,KAAAhB,MAAA,CAAAD,KAAA,UAAAM,cAAA,CAAAN,KAAA,EACA;QACAgB,SAAA;QACA,KAAAZ,OAAA,CAAAU,IAAA;QACA,KAAAR,cAAA;UAAA,QAAAL;QAAA;MACA;MAEAgB,QAAA,MAAAJ,QAAA,IAAAA,QAAA,iBAAAD,MAAA;MAEA,MAAAM,KAAA;QACA1B,SAAA,OAAAA,SAAA,CAAA2B,EAAA;QACAL,IAAA,EAAAE,SAAA,OAAAF,IAAA;QACAM,SAAA,EAAAL,YAAA;QACAE,QAAA,EAAAA,QAAA;QACAjB,KAAA,OAAAC,MAAA,CAAAD;MACA;MAEA,MAAAqB,QAAA,cAAAC,IAAA,CAAAC,IAAA;QACAC,QAAA,OAAAC,UAAA,CAAAC,MAAA;QACAR,KAAA,EAAAA;MACA;MACA,KAAAhB,KAAA,GAAAmB,QAAA,CAAAzB,IAAA,CAAA+B,OAAA;MACA,KAAAxB,UAAA,GAAAkB,QAAA,CAAAzB,IAAA,CAAAgC,KAAA;IACA;IACAC,eAAAC,QAAA;MACA,IAAAC,OAAA,GAAA1C,gBAAA,CAAA2C,eAAA;QACAR,QAAA,UAAAC,UAAA,CAAAC,MAAA;QACA9B,IAAA;UACAqC,SAAA,EAAAH;QACA;MACA;MACAC,OAAA,CACAG,IAAA,CAAAb,QAAA;QACA,MAAAc,WAAA,GAAAC,MAAA,CAAAC,GAAA,CAAAC,eAAA,CAAAjB,QAAA,CAAAzB,IAAA;QACAwC,MAAA,CAAAG,IAAA,CAAAJ,WAAA;MACA,GACAK,KAAA,CAAAC,KAAA;QACA,KAAAC,eAAA,CAAAD,KAAA;MACA;IACA;IACAE,gBAAAb,QAAA;MACA,MAAAT,QAAA,QAAAC,IAAA,CAAAsB,MAAA;QACApB,QAAA,OAAAC,UAAA,CAAAoB,gBAAA;QACAjD,IAAA;UACAqC,SAAA,EAAAH;QACA;MACA;MACAT,QAAA,CACAa,IAAA;QACA,KAAAY,MAAA,CAAAP,IAAA;UACAQ,OAAA;UACAC,IAAA;QACA;MACA,GACAR,KAAA,CAAAC,KAAA;QACA,KAAApC,MAAA,QAAA4C,WAAA,CAAAR,KAAA;MACA;IACA;IACAS,cAAA;MACA,KAAAjD,MAAA;QACAD,KAAA;MACA;MACA,KAAAS,UAAA;IACA;IACA0C,qBAAA;MACA,KAAAlD,MAAA,CAAAD,KAAA,QAAAC,MAAA,CAAAD,KAAA,CAAAoD,WAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}