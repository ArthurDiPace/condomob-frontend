{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ConfirmDialog from '@/components/ConfirmDialog.vue';\nimport SPagebar from '@/layout/SPagebar.vue';\nexport default {\n  name: 'VistoriaCreate',\n  components: {\n    SPagebar,\n    ConfirmDialog\n  },\n  data: () => ({\n    breadcrumbs: [{\n      'text': 'Vistoria',\n      'to': '/vistoria',\n      'exact': true\n    }, {\n      'text': 'Cadastrar Vistoria',\n      'disabled': true\n    }],\n    itensDefeito: [],\n    vistoria: {},\n    veiculo: {},\n    permissao: {\n      permissionario: {}\n    },\n    status: [{\n      text: 'Aprovado',\n      value: 'aprovado'\n    }, {\n      text: 'Aprovado com ressalva',\n      value: 'aprovado_com_ressalva'\n    }, {\n      text: 'Reprovado',\n      value: 'reprovado'\n    }],\n    headersItensDefeito: [{\n      text: 'Defeito',\n      value: 'item_vistoria.descricao',\n      sortable: false\n    }, {\n      text: 'Detalhes do Defeito',\n      value: 'observacao',\n      sortable: false\n    }, {\n      text: 'Ações',\n      value: 'action',\n      sortable: false\n    }],\n    itensVistoria: [],\n    errors: {},\n    pontos: [],\n    defeito: {}\n  }),\n  created() {\n    this.getPontos();\n    this.getItensVistoria();\n    this.getVistoria(this.$route.params.id);\n  },\n  methods: {\n    async getPontos() {\n      const response = await this.$api.list({\n        resource: this.$endpoints.PONTO\n      });\n      this.pontos = response.data.results;\n    },\n    async getItensVistoria() {\n      const response = await this.$api.list({\n        resource: this.$endpoints.VISTORIA_ITEM\n      });\n      this.itensVistoria = response.data.results;\n    },\n    async getVistoria(vistoriaId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.VISTORIA,\n        id: vistoriaId\n      });\n      this.vistoria = response.data;\n      this.getVeiculo(this.vistoria.veiculo);\n    },\n    async getVeiculo(veiculoId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.VEICULO,\n        id: veiculoId\n      });\n      this.veiculo = response.data;\n      this.getPermissao(this.veiculo.permissao);\n    },\n    async getPermissao(permissaoId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.PERMISSAO,\n        id: permissaoId\n      });\n      this.permissao = response.data;\n    },\n    salvar() {\n      this.vistoria.itens_defeito = this.itensDefeito.map(item => item.id);\n      const response = this.$api.update({\n        resource: this.$endpoints.VISTORIA,\n        id: this.vistoria.id,\n        data: this.vistoria\n      });\n      response.then(() => {\n        this.$toast.open({\n          message: 'Vistoria salva com sucesso',\n          type: 'success'\n        });\n        this.$router.push('/vistoria');\n      }).catch(error => {\n        this.errors = this.handleError(error);\n      });\n    },\n    limparDefeito() {\n      this.defeito = {};\n    },\n    incluirDefeito() {\n      const response = this.$api.create({\n        resource: this.$endpoints.VISTORIA_DEFEITO,\n        data: this.defeito\n      });\n      response.then(res => {\n        this.$toast.open({\n          message: 'Defeito incluído com sucesso',\n          type: 'success'\n        });\n        this.inserirDefeitoLista(res.data.id);\n        this.limparDefeito();\n      }).catch(error => {\n        this.errors = this.handleError(error);\n      });\n    },\n    async inserirDefeitoLista(id) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.VISTORIA_DEFEITO,\n        id: id,\n        query: {\n          expand: 'item_vistoria'\n        }\n      });\n      this.itensDefeito.push(response.data);\n    },\n    async excluirDefeito(item) {\n      const res = await this.$refs.confirm.open('Confirmar exclusão', 'Tem certeza que deseja excluir este registro ?');\n      if (res) {\n        const response = this.$api.destroy({\n          resource: this.$endpoints.VISTORIA_DEFEITO,\n          id: item.id\n        });\n        response.then(() => {\n          const index = this.itensDefeito.indexOf(item);\n          this.itensDefeito.splice(index, 1);\n        });\n      }\n    }\n  }\n};","map":{"version":3,"names":["ConfirmDialog","SPagebar","name","components","data","breadcrumbs","itensDefeito","vistoria","veiculo","permissao","permissionario","status","text","value","headersItensDefeito","sortable","itensVistoria","errors","pontos","defeito","created","getPontos","getItensVistoria","getVistoria","$route","params","id","methods","response","$api","list","resource","$endpoints","PONTO","results","VISTORIA_ITEM","vistoriaId","get","VISTORIA","getVeiculo","veiculoId","VEICULO","getPermissao","permissaoId","PERMISSAO","salvar","itens_defeito","map","item","update","then","$toast","open","message","type","$router","push","catch","error","handleError","limparDefeito","incluirDefeito","create","VISTORIA_DEFEITO","res","inserirDefeitoLista","query","expand","excluirDefeito","$refs","confirm","destroy","index","indexOf","splice"],"sources":["src/views/vistoria/VistoriaEdit.vue"],"sourcesContent":["<template>\n  <v-container fluid>\n    <s-pagebar\n      page-title=\"Cadastrar Vistoria\"\n      :breadcrumbs=\"breadcrumbs\"\n    />\n    <v-card flat>\n      <v-card-title>Identificação</v-card-title>\n      <v-card-text>\n        <v-row dense>\n          <v-col\n            cols=\"12\"\n            md=\"3\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"permissao.numero\"\n              label=\"Registro\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"3\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"permissao.categoria\"\n              label=\"Categoria\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"permissao.permissionario.nome\"\n              label=\"Permissionário\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.desc_marca_modelo\"\n              label=\"Marca/Modelo\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"3\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.placa\"\n              label=\"Placa\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"3\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.chassi\"\n              label=\"Chassi\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"3\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.ano_fabricacao\"\n              label=\"Ano de Fabricação\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"4\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.desc_cor\"\n              label=\"Cor\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            v-if=\"veiculo.categoria=='taxi'\"\n            cols=\"12\"\n            md=\"4\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"veiculo.taximetro\"\n              label=\"Taxímetro\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            v-if=\"veiculo.categoria!='taxi' && veiculo.desc_carroceria!='BUGGY'\"\n            cols=\"12\"\n            sm=\"12\"\n            md=\"4\"\n          >\n            <v-text-field\n              v-model=\"veiculo.tacografo\"\n              label=\"Tacógrafo\"\n              disabled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            md=\"6\"\n            sm=\"12\"\n          >\n            <v-autocomplete\n              v-if=\"veiculo.categoria=='taxi'\"\n              v-model=\"permissao.permissionario.ponto\"\n              :items=\"pontos\"\n              label=\"Ponto\"\n              item-value=\"id\"\n              disabled\n            >\n              <template #item=\"{ item }\">\n                {{ item.numero }} - {{ item.endereco }}\n              </template>\n              <template #selection=\"{ item }\">\n                {{ item.numero }} - {{ item.endereco }}\n              </template>\n            </v-autocomplete>\n          </v-col>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-textarea\n              v-model=\"permissao.observacao\"\n              label=\"Observação\"\n              filled\n              disabled\n            />\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n    <v-card\n      flat\n      class=\"my-3\"\n    >\n      <v-card-title>Defeitos</v-card-title>\n      <v-card-text>\n        <v-row dense>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-autocomplete\n              v-model=\"defeito.item_vistoria\"\n              label=\"Defeito\"\n              :items=\"itensVistoria\"\n              item-text=\"descricao\"\n              item-value=\"id\"\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-textarea\n              v-model=\"defeito.observacao\"\n              label=\"Detalhes do Defeito\"\n              filled\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n            class=\"d-flex justify-end\"\n          >\n            <v-btn\n              color=\"primary\"\n              @click=\"incluirDefeito\"\n            >\n              Incluir defeito na lista\n            </v-btn>\n          </v-col>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-data-table\n              :headers=\"headersItensDefeito\"\n              :items=\"itensDefeito\"\n              disable-pagination\n              hide-default-footer\n            >\n              <template #[`item.action`]=\"{ item }\">\n                <v-toolbar-items>\n                  <v-btn\n                    icon\n                    @click=\"excluirDefeito(item)\"\n                  >\n                    <v-icon class=\"material-icons-outlined\">\n                      delete\n                    </v-icon>\n                  </v-btn>\n                </v-toolbar-items>\n              </template>\n            </v-data-table>\n          </v-col>\n        </v-row>\n      </v-card-text>\n    </v-card>\n    <v-card\n      flat\n      class=\"my-3\"\n    >\n      <v-card-title>Vistoria</v-card-title>\n      <v-card-text>\n        <v-row dense>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-autocomplete\n              v-model=\"vistoria.parecer\"\n              :items=\"status\"\n              item-text=\"text\"\n              item-value=\"value\"\n              label=\"Parecer\"\n            />\n          </v-col>\n          <v-col\n            v-if=\"vistoria.parecer=='aprovado_com_ressalva'\"\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-text-field\n              v-model=\"vistoria.data_retorno\"\n              v-mask=\"['##/##/####']\"\n              label=\"Data de Retorno\"\n            />\n          </v-col>\n          <v-col\n            cols=\"12\"\n            sm=\"12\"\n          >\n            <v-textarea\n              v-model=\"vistoria.observacao\"\n              label=\"Observação\"\n              filled\n            />\n          </v-col>\n        </v-row>\n      </v-card-text>\n      <v-card-actions>\n        <v-spacer />\n        <v-btn\n          outlined\n          color=\"blue-grey darken-4\"\n          @click=\"$router.back()\"\n        >\n          Voltar\n        </v-btn>\n        <v-btn\n          color=\"blue-grey darken-4\"\n          dark\n          @click=\"salvar\"\n        >\n          Salvar\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n    <ConfirmDialog ref=\"confirm\" />\n  </v-container>\n</template>\n\n<script>\nimport ConfirmDialog from '@/components/ConfirmDialog.vue'\nimport SPagebar from '@/layout/SPagebar.vue'\n\nexport default {\n  name: 'VistoriaCreate',\n  components: { SPagebar, ConfirmDialog },\n  data: () => ({\n    breadcrumbs: [\n      {\n        'text': 'Vistoria',\n        'to': '/vistoria',\n        'exact': true\n      },\n      {\n        'text': 'Cadastrar Vistoria',\n        'disabled': true\n      },\n    ],\n    itensDefeito: [],\n    vistoria: {},\n    veiculo: {},\n    permissao: {\n      permissionario: {}\n    },\n    status: [\n      {text: 'Aprovado', value: 'aprovado'},\n      {text: 'Aprovado com ressalva', value: 'aprovado_com_ressalva'},\n      {text: 'Reprovado', value: 'reprovado'}\n    ],\n    headersItensDefeito: [\n      {text: 'Defeito', value: 'item_vistoria.descricao', sortable: false},\n      {text: 'Detalhes do Defeito', value: 'observacao', sortable: false},\n      {text: 'Ações', value: 'action', sortable: false},\n    ],\n    itensVistoria: [],\n    errors: {},\n    pontos: [],\n    defeito: {}\n  }),\n  created() {\n    this.getPontos()\n    this.getItensVistoria()\n    this.getVistoria(this.$route.params.id)\n  },\n  methods: {\n    async getPontos() {\n      const response = await this.$api.list({\n        resource: this.$endpoints.PONTO\n      })\n      this.pontos = response.data.results\n    },\n    async getItensVistoria() {\n      const response = await this.$api.list({\n        resource: this.$endpoints.VISTORIA_ITEM\n      })\n      this.itensVistoria = response.data.results\n    },\n    async getVistoria(vistoriaId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.VISTORIA,\n        id: vistoriaId\n      })\n      this.vistoria = response.data\n      this.getVeiculo(this.vistoria.veiculo)\n    },\n    async getVeiculo(veiculoId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.VEICULO,\n        id: veiculoId\n      })\n      this.veiculo = response.data\n      this.getPermissao(this.veiculo.permissao)\n    },\n    async getPermissao(permissaoId) {\n      const response = await this.$api.get({\n        resource: this.$endpoints.PERMISSAO,\n        id: permissaoId\n      })\n      this.permissao = response.data\n    },\n    salvar() {\n      this.vistoria.itens_defeito = this.itensDefeito.map(item=>item.id)\n      const response = this.$api.update({\n        resource: this.$endpoints.VISTORIA,\n        id: this.vistoria.id,\n        data: this.vistoria\n      })\n      response\n        .then(()=>{\n          this.$toast.open({\n              message: 'Vistoria salva com sucesso',\n              type: 'success',\n          })\n          this.$router.push('/vistoria')\n        })\n        .catch(error=>{\n          this.errors = this.handleError(error)\n        })\n    },\n    limparDefeito() {\n      this.defeito = {}\n    },\n    incluirDefeito() {\n      const response = this.$api.create({\n        resource: this.$endpoints.VISTORIA_DEFEITO,\n        data: this.defeito\n      })\n      response\n        .then((res)=>{\n          this.$toast.open({\n              message: 'Defeito incluído com sucesso',\n              type: 'success',\n          })\n          this.inserirDefeitoLista(res.data.id)\n          this.limparDefeito()\n        })\n        .catch(error=>{\n          this.errors = this.handleError(error)\n        })\n    },\n    async inserirDefeitoLista(id){\n      const response = await this.$api.get({\n        resource: this.$endpoints.VISTORIA_DEFEITO,\n        id: id,\n        query: {\n          expand: 'item_vistoria'\n        }\n      })\n      this.itensDefeito.push(response.data)\n    },\n    async excluirDefeito(item) {\n        const res = await this.$refs.confirm.open(\n          'Confirmar exclusão',\n          'Tem certeza que deseja excluir este registro ?'\n        )\n        if (res) {\n          const response = this.$api.destroy({\n            resource: this.$endpoints.VISTORIA_DEFEITO,\n            id: item.id\n          })\n          response.then(()=>{\n            const index = this.itensDefeito.indexOf(item)\n            this.itensDefeito.splice(index, 1)\n          })\n        }\n    },\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}