{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport SPagebar from '@/layout/SPagebar.vue';\nexport default {\n  name: 'PermissaoList',\n  components: {\n    SPagebar\n  },\n  data: () => ({\n    breadcrumbs: [{\n      'text': 'Permissões',\n      'to': '/permissao',\n      'exact': true\n    }],\n    categorias: [{\n      text: 'Táxi',\n      value: 'taxi'\n    }, {\n      text: 'Escolar',\n      value: 'escolar'\n    }, {\n      text: 'Turismo',\n      value: 'turismo'\n    }, {\n      text: 'Fretamento',\n      value: 'fretamento'\n    }],\n    headers: [{\n      text: 'Registro',\n      value: 'numero'\n    }, {\n      text: 'Categoria',\n      value: 'categoria'\n    }, {\n      text: 'Permissionário',\n      value: 'permissionario.nome'\n    }, {\n      text: 'CPF/CNPJ',\n      value: 'permissionario.numero_documento'\n    }, {\n      text: 'Status',\n      value: 'status'\n    }, {\n      text: 'Ações',\n      value: 'action'\n    }],\n    placa: {},\n    categoria: {},\n    numero_documento: {},\n    numero: {},\n    filtro: {\n      numero: null,\n      categoria: null,\n      placa: null,\n      numero_documento: null\n    },\n    totalItems: 0,\n    items: [],\n    options: {},\n    dialog: false,\n    errors: [],\n    filtroAnterior: {\n      numero: null,\n      categoria: null,\n      placa: null,\n      numero_documento: null\n    }\n  }),\n  watch: {\n    options: {\n      handler() {\n        this.getPermissoes();\n      },\n      deep: true\n    }\n  },\n  methods: {\n    async getPermissoes() {\n      const {\n        sortBy,\n        sortDesc,\n        page,\n        itemsPerPage\n      } = this.options;\n      let resetPage = false;\n      let ordering = sortBy[0];\n      if (sortDesc[0]) {\n        ordering = `-${ordering}`;\n      }\n      if (this.filtro.categoria !== this.filtroAnterior.categoria || this.filtro.numero_documento !== this.filtroAnterior.numero_documento || this.filtro.placa !== this.filtroAnterior.placa || this.filtro.numero !== this.filtroAnterior.numero) {\n        resetPage = true;\n        this.options.page = 1;\n        this.filtroAnterior = {\n          ...this.filtro\n        };\n      }\n      ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n      const query = {\n        page: resetPage ? 1 : page,\n        page_size: itemsPerPage,\n        ordering: ordering,\n        categoria: this.filtro.categoria,\n        numero: this.filtro.numero,\n        placa: this.filtro.placa,\n        numero_documento: this.filtro.numero_documento\n      };\n      const response = await this.$api.list({\n        resource: this.$endpoints.PERMISSAO,\n        query: query\n      });\n      this.items = response.data.results;\n      this.totalItems = response.data.count;\n    },\n    cadastrarPermissao() {\n      const response = this.$api.create({\n        resource: this.$endpoints.PERMISSAO,\n        data: {\n          categoria: this.categoria\n        }\n      });\n      response.then(res => {\n        this.editarPermissao(res.data.id);\n        this.dialog = false;\n      }).catch(error => {\n        this.errors = this.handleError(error);\n      });\n    },\n    editarPermissao(id) {\n      this.$router.push(`/permissao/${id}`);\n    },\n    limparFiltros() {\n      this.filtro = {\n        numero: null,\n        categoria: null,\n        placa: null,\n        numero_documento: null\n      };\n      this.getPermissoes();\n    },\n    transformToUppercase() {\n      this.filtro.placa = this.filtro.placa.toUpperCase();\n    },\n    formatarDocumento(documento) {\n      if (!documento) return null;\n      documento = documento.replace(/[^\\d]/g, '');\n      if (documento.length == 11) {\n        return documento.replace(/^(\\d{3})(\\d{3})(\\d{3})(\\d{2})$/, '$1.$2.$3-$4');\n      } else {\n        return documento.replace(/^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/, '$1.$2.$3/$4-$5');\n      }\n    }\n  }\n};","map":{"version":3,"names":["SPagebar","name","components","data","breadcrumbs","categorias","text","value","headers","placa","categoria","numero_documento","numero","filtro","totalItems","items","options","dialog","errors","filtroAnterior","watch","handler","getPermissoes","deep","methods","sortBy","sortDesc","page","itemsPerPage","resetPage","ordering","query","page_size","response","$api","list","resource","$endpoints","PERMISSAO","results","count","cadastrarPermissao","create","then","res","editarPermissao","id","catch","error","handleError","$router","push","limparFiltros","transformToUppercase","toUpperCase","formatarDocumento","documento","replace","length"],"sources":["src/views/permissao/PermissaoList.vue"],"sourcesContent":["<template>\n  <v-container fluid>\n    <s-pagebar\n      page-title=\"Permissões\"\n      :breadcrumbs=\"breadcrumbs\"\n    >\n      <v-btn\n        color=\"blue-grey darken-4\"\n        dark\n        fab\n        small\n        @click=\"dialog=true\"\n      >\n        <v-icon>add</v-icon>\n      </v-btn>\n    </s-pagebar>\n    <v-card flat>\n      <v-card-text>\n        <div class=\"d-flex align-center\">\n          <div style=\"max-width: 200px\">\n            <v-text-field\n              v-model=\"filtro.numero\"\n              label=\"Número\"\n              class=\"mr-3\"\n            />\n          </div>\n          <div style=\"max-width: 500px\">\n            <v-autocomplete\n              v-model=\"filtro.categoria\"\n              label=\"Categoria\"\n              :items=\"categorias\"\n              class=\"mr-3\"\n            />\n          </div>\n          <div style=\"max-width: 500px\">\n            <v-text-field\n              v-model=\"filtro.numero_documento\"\n              v-mask=\"['XXX.XXX.XXX-XX', 'XX.XXX.XXX/XXXX-XX']\"\n              label=\"Nº Documento\"\n              :items=\"numero_documento\"\n              class=\"mr-3\"\n            />\n          </div>\n          <div style=\"max-width: 500px\">\n            <v-text-field\n              v-model=\"filtro.placa\"\n              label=\"Placa\"\n              :items=\"placa\"\n              class=\"mr-3\"\n              @input=\"transformToUppercase\"\n            />\n          </div>\n          <v-btn\n            color=\"blue-grey darken-4 mr-3\"\n            dark\n            @click=\"getPermissoes\"\n          >\n            <v-icon>search</v-icon>\n            Pesquisar\n          </v-btn>\n          <v-btn\n            outlined\n            color=\"blue-grey darken-4\"\n            @click=\"limparFiltros\"\n          >\n            Limpar filtros\n          </v-btn>\n        </div>\n        <v-data-table\n          :headers=\"headers\"\n          :items=\"items\"\n          :options.sync=\"options\"\n          :server-items-length=\"totalItems\"\n          :items-per-page=\"10\"\n          :footer-props=\"{\n            'items-per-page-options': [10, 20, 30]\n          }\"\n        >\n          <template #[`item.numero`]=\"{ item }\">\n            <span v-if=\"!!item.numero\">{{ item.numero.toString().padStart(4, '0') }}</span>\n          </template>\n          <template #[`item.categoria`]=\"{ item }\">\n            <span v-if=\"item.categoria=='taxi'\">Táxi</span>\n            <span v-if=\"item.categoria=='escolar'\">Escolar</span>\n            <span v-if=\"item.categoria=='turismo'\">Turismo</span>\n            <span v-if=\"item.categoria=='fretamento'\">Fretamento</span>\n          </template>\n          <template #[`item.permissionario.numero_documento`]=\"{ item }\">\n            {{ item.permissionario && formatarDocumento(item.permissionario.numero_documento) }}\n          </template>\n          <template #[`item.placa`]=\"{ item }\">\n            <span v-if=\"!!item.placa\" />\n          </template>\n          <template #[`item.status`]=\"{ item }\">\n            <v-chip\n              v-if=\"item.status=='disponivel'\"\n              color=\"grey\"\n              dark\n            >\n              {{ item.status }}\n            </v-chip>\n            <v-chip\n              v-if=\"item.status=='ativa'\"\n              color=\"green\"\n              dark\n            >\n              {{ item.status }}\n            </v-chip>\n            <v-chip\n              v-if=\"item.status=='bloqueada'\"\n              color=\"red\"\n              dark\n            >\n              {{ item.status }}\n            </v-chip>\n          </template>\n          <template #[`item.action`]=\"{ item }\">\n            <v-toolbar-items>\n              <v-tooltip bottom>\n                <template #activator=\"{ on, attrs }\">\n                  <v-btn\n                    v-bind=\"attrs\"\n                    icon\n                    v-on=\"on\"\n                    @click=\"editarPermissao(item.id)\"\n                  >\n                    <v-icon class=\"material-icons-outlined\">\n                      visibility\n                    </v-icon>\n                  </v-btn>\n                </template>\n                <span>Visualizar</span>\n              </v-tooltip>\n            </v-toolbar-items>\n          </template>\n        </v-data-table>\n      </v-card-text>\n    </v-card>\n\n    <v-dialog\n      v-model=\"dialog\"\n      max-width=\"600\"\n    >\n      <v-card>\n        <v-card-title class=\"text-h5\">\n          Selecione a categoria para iniciar o cadastro:\n        </v-card-title>\n\n        <v-card-text>\n          <v-autocomplete\n            v-model=\"categoria\"\n            label=\"Categoria\"\n            :items=\"categorias\"\n            :error-messages=\"errors.categoria\"\n          />\n        </v-card-text>\n\n        <v-card-actions>\n          <v-spacer />\n\n          <v-btn\n            color=\"grey darken-1\"\n            text\n            @click=\"dialog = false\"\n          >\n            Cancelar\n          </v-btn>\n\n          <v-btn\n            color=\"blue-grey darken-4\"\n            text\n            @click=\"cadastrarPermissao\"\n          >\n            Iniciar cadastro\n          </v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nimport SPagebar from '@/layout/SPagebar.vue'\nexport default {\n  name: 'PermissaoList',\n  components: { SPagebar },\n  data: () => ({\n    breadcrumbs: [\n      {\n        'text': 'Permissões',\n        'to': '/permissao',\n        'exact': true\n      }\n    ],\n    categorias: [\n      {text: 'Táxi', value: 'taxi'},\n      {text: 'Escolar', value: 'escolar'},\n      {text: 'Turismo', value: 'turismo'},\n      {text: 'Fretamento', value: 'fretamento'},\n    ],\n    headers: [\n      {text: 'Registro', value: 'numero'},\n      {text: 'Categoria', value: 'categoria'},\n      {text: 'Permissionário', value: 'permissionario.nome'},\n      {text: 'CPF/CNPJ', value: 'permissionario.numero_documento'},\n      {text: 'Status', value: 'status'},\n      {text: 'Ações', value: 'action'},\n    ],\n    placa:{},\n    categoria:{},\n    numero_documento:{},\n    numero:{},\n    filtro: {\n      numero: null,\n      categoria: null,\n      placa: null,\n      numero_documento: null,\n    },\n    totalItems: 0,\n    items: [],\n    options: {},\n    dialog: false,   \n    errors: [],\n    filtroAnterior: {\n      numero: null,\n      categoria: null,\n      placa: null,\n      numero_documento: null,\n    },\n  }),\n  watch: {\n    options: {\n      handler() {\n        this.getPermissoes()\n      },\n      deep: true\n    },\n  },\n  methods: {\n    async getPermissoes() {\n      const { sortBy, sortDesc, page, itemsPerPage } = this.options\n      \n      let resetPage = false;\n      let ordering = sortBy[0];\n      if (sortDesc[0]) {\n        ordering = `-${ordering}`;\n      }\n\n      if (\n        this.filtro.categoria !== this.filtroAnterior.categoria ||\n        this.filtro.numero_documento !== this.filtroAnterior.numero_documento ||\n        this.filtro.placa !== this.filtroAnterior.placa ||\n        this.filtro.numero !== this.filtroAnterior.numero\n      ) {\n        resetPage = true;\n        this.options.page = 1;\n        this.filtroAnterior = { ...this.filtro };\n      }\n      \n      ordering = `${sortDesc && sortDesc[0] ? '-' : ''}${sortBy}`;\n      \n      const query = {\n        page: resetPage ? 1 : page,\n        page_size: itemsPerPage,\n        ordering: ordering,\n        categoria: this.filtro.categoria,\n        numero: this.filtro.numero,\n        placa: this.filtro.placa,\n        numero_documento: this.filtro.numero_documento\n      }\n      \n      const response = await this.$api.list({\n        resource: this.$endpoints.PERMISSAO,\n        query: query\n      })\n      this.items = response.data.results\n      this.totalItems = response.data.count\n    },\n    cadastrarPermissao(){\n      const response = this.$api.create({\n        resource: this.$endpoints.PERMISSAO,\n        data: {\n          categoria: this.categoria,\n        }\n      })\n      response.then(res=>{\n        this.editarPermissao(res.data.id)\n        this.dialog = false\n      })\n      .catch(error=>{\n        this.errors = this.handleError(error)\n      })\n    },\n    editarPermissao(id) {\n      this.$router.push(`/permissao/${id}`)\n    },\n    limparFiltros() {\n      this.filtro = {\n        numero: null,\n        categoria: null,\n        placa: null,\n        numero_documento: null,\n      }\n      this.getPermissoes()\n    },\n    transformToUppercase() {\n      this.filtro.placa = this.filtro.placa.toUpperCase();\n    },\n    formatarDocumento(documento) {\n      if (!documento) return null;\n      documento = documento.replace(/[^\\d]/g, '');\n      if (documento.length == 11) {\n        return documento.replace(/^(\\d{3})(\\d{3})(\\d{3})(\\d{2})$/, '$1.$2.$3-$4');\n      } else {\n        return documento.replace(/^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/, '$1.$2.$3/$4-$5');\n      }\n    }\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}